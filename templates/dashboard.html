{% extends "base.html" %}

{% block title %}Dashboard - L.A.A.R.I{% endblock %}

{% block content %}
<div class="dashboard-header mb-4">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
            <h1 class="display-6 fw-bold">
                <i class="fas fa-home me-3"></i>{{ _('Dashboard') }} L.A.A.R.I
            </h1>
            <p class="lead text-muted mb-0">{{ _('Bem-vindo ao sistema de gestão arqueológica') }}, {{ current_user.username }}!</p>
        </div>
        <button class="btn btn-archaeological d-flex align-items-center gap-2 px-3 py-2 shadow-sm" 
                type="button" 
                id="teamGalleryBtn"
                data-bs-toggle="modal" 
                data-bs-target="#teamGalleryModal"
                data-i18n-aria="btn_conheca_equipe">
            <i class="fas fa-users"></i>
            <span data-i18n="btn_conheca_equipe">Conheça nossa equipe</span>
        </button>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row g-4 mb-5">
    <div class="col-lg-4 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center p-4">
                <div class="stat-icon bg-archaeological text-white rounded-circle mx-auto mb-3">
                    <i class="fas fa-archive fa-2x"></i>
                </div>
                <h3 class="h4 fw-bold">{{ stats.artifacts }}</h3>
                <p class="text-muted mb-0">{{ _('Artefatos Catalogados') }}</p>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center p-4">
                <div class="stat-icon bg-archaeological text-white rounded-circle mx-auto mb-3">
                    <i class="fas fa-users fa-2x"></i>
                </div>
                <h3 class="h4 fw-bold">{{ stats.professionals }}</h3>
                <p class="text-muted mb-0">{{ _('Profissionais Cadastrados') }}</p>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body text-center p-4">
                <div class="stat-icon bg-warning text-white rounded-circle mx-auto mb-3">
                    <i class="fas fa-truck fa-2x"></i>
                </div>
                <h3 class="h4 fw-bold">{{ stats.pending_transports }}</h3>
                <p class="text-muted mb-0">{{ _('Transportes Pendentes') }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Main Modules -->
<div class="modules-grid">
    <h2 class="h3 mb-4">{{ _('Módulos Principais') }}</h2>
    
    <div class="row g-4">
        <div class="col-lg-4 col-md-6">
            <div class="card module-card h-100 border-0 shadow-sm">
                <div class="card-body p-4 text-center">
                    <div class="module-icon bg-archaeological text-white rounded-circle mx-auto mb-3">
                        <i class="fas fa-archive fa-2x"></i>
                    </div>
                    <h4 class="card-title">{{ _('Acervo') }}</h4>
                    <p class="card-text text-muted">{{ _('Consulta organizada de todos os itens catalogados no sistema.') }}</p>
                    <a href="{{ url_for('acervo') }}" class="btn btn-archaeological">
                        <i class="fas fa-arrow-right me-2"></i>{{ _('Acessar Acervo') }}
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6">
            <div class="card module-card h-100 border-0 shadow-sm">
                <div class="card-body p-4 text-center">
                    <div class="module-icon bg-archaeological text-white rounded-circle mx-auto mb-3">
                        <i class="fas fa-tags fa-2x"></i>
                    </div>
                    <h4 class="card-title">{{ _('Catalogação') }}</h4>
                    <p class="card-text text-muted">{{ _('Sistema completo de registro e catalogação de artefatos.') }}</p>
                    <a href="{{ url_for('catalogacao') }}" class="btn btn-archaeological">
                        <i class="fas fa-arrow-right me-2"></i>{{ _('Gerenciar Catalogação') }}
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6">
            <div class="card module-card h-100 border-0 shadow-sm">
                <div class="card-body p-4 text-center">
                    <div class="module-icon bg-archaeological text-white rounded-circle mx-auto mb-3">
                        <i class="fas fa-cube fa-2x"></i>
                    </div>
                    <h4 class="card-title">{{ _('Modelo 3D') }}</h4>
                    <p class="card-text text-muted">{{ _('Integração com tecnologia de digitalização tridimensional.') }}</p>
                    <a href="{{ url_for('scanner_3d') }}" class="btn btn-archaeological">
                        <i class="fas fa-arrow-right me-2"></i>{{ _('Acessar Modelos') }}
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6">
            <div class="card module-card h-100 border-0 shadow-sm">
                <div class="card-body p-4 text-center">
                    <div class="module-icon bg-archaeological text-white rounded-circle mx-auto mb-3">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                    <h4 class="card-title">{{ _('Profissionais da Região') }}</h4>
                    <p class="card-text text-muted">{{ _('Diretório completo de arqueólogos e especialistas.') }}</p>
                    <a href="{{ url_for('profissionais') }}" class="btn btn-archaeological">
                        <i class="fas fa-arrow-right me-2"></i>{{ _('Ver Profissionais') }}
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6">
            <div class="card module-card h-100 border-0 shadow-sm">
                <div class="card-body p-4 text-center">
                    <div class="module-icon bg-archaeological text-white rounded-circle mx-auto mb-3">
                        <i class="fas fa-clipboard-list fa-2x"></i>
                    </div>
                    <h4 class="card-title">{{ _('Inventário') }}</h4>
                    <p class="card-text text-muted">{{ _('Controle detalhado do inventário arqueológico.') }}</p>
                    <a href="{{ url_for('inventario') }}" class="btn btn-archaeological">
                        <i class="fas fa-arrow-right me-2"></i>{{ _('Gerenciar Inventário') }}
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6">
            <div class="card module-card h-100 border-0 shadow-sm">
                <div class="card-body p-4 text-center">
                    <div class="module-icon bg-archaeological text-white rounded-circle mx-auto mb-3">
                        <i class="fas fa-truck fa-2x"></i>
                    </div>
                    <h4 class="card-title">{{ _('Transporte de Artefatos') }}</h4>
                    <p class="card-text text-muted">{{ _('Controle e rastreamento da movimentação de itens.') }}</p>
                    <a href="{{ url_for('transporte') }}" class="btn btn-archaeological">
                        <i class="fas fa-arrow-right me-2"></i>{{ _('Controlar Transporte') }}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

{% if current_user.is_admin %}
<div class="admin-section mt-5">
    <div class="alert alert-info border-0">
        <h5 class="alert-heading">
            <i class="fas fa-crown me-2"></i>{{ _('Painel Administrativo') }}
        </h5>
        <p class="mb-2">{{ _('Você possui privilégios de administrador neste sistema.') }}</p>
        <a href="{{ url_for('admin') }}" class="btn btn-sm btn-info">
            <i class="fas fa-cog me-2"></i>{{ _('Acessar Administração') }}
        </a>
    </div>
</div>
{% endif %}

<!-- Modal da Galeria da Equipe -->
<div class="modal fade" id="teamGalleryModal" tabindex="-1" aria-labelledby="teamGalleryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <!-- Cabeçalho do Modal -->
            <div class="modal-header bg-archaeological text-white">
                <div>
                    <h5 class="modal-title" id="teamGalleryModalLabel" data-i18n="galeria_modal_title">Nossa Equipe - Tech Era</h5>
                    <small class="d-block opacity-75" data-i18n="galeria_modal_desc">Conheça os membros da equipe Tech Era e nossos projetos</small>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <!-- Corpo do Modal -->
            <div class="modal-body p-4">
                <!-- Seção Descritiva da Tech Era -->
                <div class="team-about-section mb-5">
                    <h4 class="text-archaeological mb-3" data-i18n="team_about_title">Sobre a Tech Era</h4>
                    <p class="lead" data-i18n="team_about_intro">
                        Somos a Tech Era, uma equipe apaixonada por ciência, tecnologia e robótica! 
                        Participamos da FIRST Lego League (FLL), onde aprendemos a usar a criatividade e o trabalho em equipe para transformar ideias em soluções reais.
                    </p>
                    
                    <p class="mb-3" data-i18n="team_core_values_title">
                        Guiados pelos 6 pilares do Core Values, buscamos colocar em prática cada um deles em tudo o que fazemos:
                    </p>
                    
                    <div class="core-values-list">
                        <div class="core-value-item">
                            <span class="cv-icon"><i class="fas fa-lightbulb"></i></span>
                            <span data-i18n="team_cv_discovery">Descoberta: aprendemos algo novo a cada desafio.</span>
                        </div>
                        <div class="core-value-item">
                            <span class="cv-icon"><i class="fas fa-rocket"></i></span>
                            <span data-i18n="team_cv_innovation">Inovação: criamos soluções criativas e originais.</span>
                        </div>
                        <div class="core-value-item">
                            <span class="cv-icon"><i class="fas fa-globe"></i></span>
                            <span data-i18n="team_cv_impact">Impacto: usamos o que sabemos para melhorar o mundo ao nosso redor.</span>
                        </div>
                        <div class="core-value-item">
                            <span class="cv-icon"><i class="fas fa-hands-helping"></i></span>
                            <span data-i18n="team_cv_inclusion">Inclusão: valorizamos cada voz e respeitamos as diferenças.</span>
                        </div>
                        <div class="core-value-item">
                            <span class="cv-icon"><i class="fas fa-users"></i></span>
                            <span data-i18n="team_cv_teamwork">Trabalho em equipe: colaboramos e crescemos juntos.</span>
                        </div>
                        <div class="core-value-item">
                            <span class="cv-icon"><i class="fas fa-smile"></i></span>
                            <span data-i18n="team_cv_fun">Diversão: celebramos cada conquista com alegria e entusiasmo!</span>
                        </div>
                    </div>
                    
                    <p class="lead text-center mt-4 mb-0 text-archaeological fw-bold" data-i18n="team_conclusion">
                        Acreditamos que a verdadeira tecnologia está nas pessoas — e é com união, curiosidade e propósito que a Tech Era constrói o futuro!
                    </p>
                    
                    <hr class="my-4">
                    <h5 class="text-center mb-4">Galeria de Fotos da Equipe</h5>
                </div>
                
                <!-- Área de carregamento -->
                <div id="galleryLoading" class="text-center py-5">
                    <div class="spinner-border text-archaeological" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="text-muted mt-3">Carregando galeria...</p>
                </div>
                
                <!-- Grid de fotos -->
                <div id="galleryGrid" class="row g-3 d-none">
                    <!-- As fotos serão carregadas dinamicamente via JavaScript -->
                </div>
                
                <!-- Estado vazio -->
                <div id="galleryEmpty" class="text-center py-5 d-none">
                    <i class="fas fa-images fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted">Nenhuma foto disponível</h4>
                    <p class="text-muted">A galeria está vazia no momento.</p>
                </div>
            </div>
            
            <!-- Rodapé do Modal -->
            <div class="modal-footer border-0 bg-light">
                <button type="button" class="btn btn-archaeological" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i><span data-i18n="galeria_close">Fechar</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para visualização de foto individual -->
<div class="modal fade" id="photoViewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content bg-transparent border-0">
            <div class="modal-header border-0">
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0 text-center">
                <img id="photoViewImage" src="" class="img-fluid rounded" alt="" style="max-height: 85vh; object-fit: contain;">
            </div>
            <div id="photoViewInfo" class="modal-footer border-0 bg-white bg-opacity-90">
                <div class="w-100">
                    <h5 id="photoViewTitle" class="mb-2"></h5>
                    <p id="photoViewDescription" class="text-muted mb-0"></p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Add hover effects to module cards
    document.querySelectorAll('.module-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.transition = 'transform 0.3s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
</script>

<script>
/**
 * Script para carregar e exibir a galeria da equipe no modal
 * Carrega fotos dinamicamente da API e permite visualização em tela cheia
 */
(function() {
    'use strict';
    
    // Elementos do DOM
    const teamGalleryModal = document.getElementById('teamGalleryModal');
    const galleryLoading = document.getElementById('galleryLoading');
    const galleryGrid = document.getElementById('galleryGrid');
    const galleryEmpty = document.getElementById('galleryEmpty');
    const photoViewModal = new bootstrap.Modal(document.getElementById('photoViewModal'));
    const photoViewImage = document.getElementById('photoViewImage');
    const photoViewTitle = document.getElementById('photoViewTitle');
    const photoViewDescription = document.getElementById('photoViewDescription');
    
    // Variável para controlar se as fotos já foram carregadas
    let photosLoaded = false;
    
    /**
     * Carrega as fotos da galeria via API
     */
    function loadGalleryPhotos() {
        // Se já carregou, não carrega novamente
        if (photosLoaded) return;
        
        // Mostra loading
        galleryLoading.classList.remove('d-none');
        galleryGrid.classList.add('d-none');
        galleryEmpty.classList.add('d-none');
        
        // Faz requisição para a API
        fetch('{{ url_for("api_gallery_photos") }}')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.photos.length > 0) {
                    renderGalleryPhotos(data.photos);
                    photosLoaded = true;
                } else {
                    showEmptyState();
                }
            })
            .catch(error => {
                console.error('Erro ao carregar fotos da galeria:', error);
                showEmptyState();
            })
            .finally(() => {
                galleryLoading.classList.add('d-none');
            });
    }
    
    /**
     * Renderiza as fotos no grid
     * @param {Array} photos - Array de fotos da API
     */
    function renderGalleryPhotos(photos) {
        galleryGrid.innerHTML = '';
        
        photos.forEach(photo => {
            const photoElement = createPhotoElement(photo);
            galleryGrid.appendChild(photoElement);
        });
        
        galleryGrid.classList.remove('d-none');
        
        // Aplica traduções aos novos elementos
        if (window.I18n) {
            window.I18n.updatePageContent();
        }
    }
    
    /**
     * Cria um elemento de foto para o grid
     * @param {Object} photo - Dados da foto
     * @returns {HTMLElement} - Elemento div da foto
     */
    function createPhotoElement(photo) {
        const col = document.createElement('div');
        col.className = 'col-lg-4 col-md-6';
        
        const imagePath = photo.image_path.startsWith('static/') 
            ? '{{ url_for("static", filename="") }}' + photo.image_path.replace('static/', '')
            : '{{ url_for("static", filename="") }}' + photo.image_path;
        
        col.innerHTML = `
            <div class="gallery-item" data-photo-id="${photo.id}">
                <img src="${imagePath}" alt="${photo.title}" loading="lazy">
                <span class="gallery-badge">
                    <i class="fas fa-users me-1"></i>Equipe
                </span>
                <div class="gallery-item-overlay">
                    <p class="gallery-item-title">${photo.title}</p>
                </div>
            </div>
        `;
        
        // Adiciona evento de clique para abrir foto em tela cheia
        const galleryItem = col.querySelector('.gallery-item');
        galleryItem.addEventListener('click', () => {
            openPhotoViewer(photo, imagePath);
        });
        
        return col;
    }
    
    /**
     * Abre o modal de visualização de foto
     * @param {Object} photo - Dados da foto
     * @param {String} imagePath - Caminho da imagem
     */
    function openPhotoViewer(photo, imagePath) {
        photoViewImage.src = imagePath;
        photoViewImage.alt = photo.title;
        photoViewTitle.textContent = photo.title;
        photoViewDescription.textContent = photo.description || '';
        
        // Esconde o info se não houver descrição
        const photoViewInfo = document.getElementById('photoViewInfo');
        if (!photo.description) {
            photoViewInfo.classList.add('d-none');
        } else {
            photoViewInfo.classList.remove('d-none');
        }
        
        photoViewModal.show();
    }
    
    /**
     * Mostra o estado vazio (sem fotos)
     */
    function showEmptyState() {
        galleryGrid.classList.add('d-none');
        galleryEmpty.classList.remove('d-none');
    }
    
    /**
     * Evento quando o modal é aberto
     * Carrega as fotos na primeira vez
     */
    if (teamGalleryModal) {
        teamGalleryModal.addEventListener('shown.bs.modal', function() {
            loadGalleryPhotos();
        });
    }
    
    console.log('L.A.A.R.I Dashboard: Sistema de galeria da equipe carregado');
})();
</script>
{% endblock %}
